<!DOCTYPE html>
<html>
<head>
    <title>Flask CRUD with Socket.IO</title>
</head>
<body>
    <h1>Users</h1>
    <ul id="user-list"></ul>

    <h2>Add User</h2>
    <form id="add-user-form">
        <input type="text" id="name" placeholder="Name" required>
        <input type="email" id="email" placeholder="Email" required>
        <button type="submit">Add</button>
    </form>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.2/socket.io.js"></script>
    <script>
        const socket = io();

        // Function to fetch and display users
        async function fetchUsers() {
            const response = await fetch('/users');
            const users = await response.json();
            const userList = document.getElementById('user-list');
            userList.innerHTML = '';
            users.forEach(user => {
                const li = document.createElement('li');
                li.textContent = `${user.name} (${user.email})`;
                li.id = `user-${user.id}`;
                userList.appendChild(li);
            });
        }

        // Add user form submission
        document.getElementById('add-user-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            await fetch('/users', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name, email })
            });
            document.getElementById('name').value = '';
            document.getElementById('email').value = '';
        });

        // Socket.IO event listeners
        socket.on('new_user', (data) => {
            const userList = document.getElementById('user-list');
            const li = document.createElement('li');
            li.textContent = `${data.name} (${data.email})`;
            li.id = `user-${data.id}`;
            userList.appendChild(li);
        });

        socket.on('updated_user', (data) => {
            const userElement = document.getElementById(`user-${data.id}`);
            if (userElement) {
                userElement.textContent = `${data.name} (${data.email})`;
            }
        });

        socket.on('deleted_user', (data) => {
            const userElement = document.getElementById(`user-${data.id}`);
            if (userElement) {
                userElement.remove();
            }
        });

        // Initial fetch of users
        fetchUsers();
    </script>
</body>
</html>
